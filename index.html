<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–∞</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –ª–æ—Ç–æ–≤, –µ—Å–ª–∏ Tailwind –Ω–µ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤—Å–µ */
        .lot-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }

        .lot-item {
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .lot-item img {
            max-width: 100%;
            height: 180px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤—ã—Å–æ—Ç–∞ –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
            object-fit: cover; /* –û–±—Ä–µ–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ */
            border-radius: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .message-area {
            display: none; /* –°–∫—Ä—ã–≤–∞–µ–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é */
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            font-weight: bold;
            text-align: center;
        }

        .message-area.success {
            background-color: #d4edda;
            color: #155724;
        }

        .message-area.error {
            background-color: #f8d7da;
            color: #721c24;
        }

        .message-area.info {
            background-color: #cce5ff;
            color: #004085;
        }
    </style>
</head>

<body class="bg-gray-100 text-gray-900">
    <div class="max-w-xl mx-auto p-6">
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold">üßô‚Äç‚ôÄÔ∏è –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç —Å–∫–∞–∑–æ—á–Ω–æ–π –º—É–¥—Ä–æ—Å—Ç–∏</h1>
            <p class="text-sm text-gray-600">–¶–∏—Ñ—Ä–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–º—ã—Å–ª–æ–≤ –∏ —á—É–¥–µ—Å</p>
        </div>

        <div class="bg-white rounded-2xl shadow p-4 mb-4">
            <h2 class="text-xl font-semibold mb-2">üë§ –ü—Ä–æ—Ñ–∏–ª—å —É—á–∞—Å—Ç–Ω–∏–∫–∞</h2>
            <p><strong>–ò–º—è:</strong> <span id="username">‚Äì</span></p>
            <p><strong>–°–∫–∞–∑–æ—á–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å:</strong> <span id="points" class="text-green-600 font-bold">‚Ä¶</span></p>
        </div>
        <div id="team-box" class="bg-white rounded-2xl shadow p-4 mb-4">
            <h2 class="text-xl font-semibold mb-2">üèÜ –ö–æ–º–∞–Ω–¥–∞: <span id="team-name">‚Äì</span></h2>
            <p><strong>–°–∫–∞–∑–æ—á–Ω–∞—è –º—É–¥—Ä–æ—Å—Ç—å:</strong> <span id="team-points" class="text-blue-600 font-bold">‚Äì</span></p>
        </div>

        <div id="message-area" class="message-area"></div>

        <div id="tasks-container" class="space-y-4 mb-4"></div>

        <div class="bg-white rounded-2xl shadow p-4 mt-4">
            <h2 class="text-xl font-semibold mb-2">üí∞ –ú–∞–≥–∞–∑–∏–Ω –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (–ê—É–∫—Ü–∏–æ–Ω)</h2>
            <div id="lots-display" class="lot-grid">
                <p class="text-gray-500 col-span-full" id="loading-lots-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ—Ç–æ–≤...</p>
            </div>
        </div>

        <div class="text-center text-xs text-gray-500 mt-6">
            –ë–æ–ª—å—à–∞—è –ø–µ—Ä–µ–º–µ–Ω–∞ ¬© 2025
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
tg.ready();
const user = tg.initDataUnsafe.user;
const userId = user?.id;
const username = user?.username || user?.first_name || "–ë–µ–∑ –∏–º–µ–Ω–∏";
const keyword = tg.initDataUnsafe.start_param;

document.getElementById('username').textContent = username;

// !!! –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–æ—Ç URL –Ω–∞ URL –≤–∞—à–µ–≥–æ Vercel-–ø—Ä–æ–∫—Å–∏
const PROXY_API_URL = 'https://telegram-gamification-proxy-git-main-mashuks-projects-27504670.vercel.app';

// –≠–ª–µ–º–µ–Ω—Ç—ã UI –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞
const pointsDisplay = document.getElementById('points');
const teamNameDisplay = document.getElementById('team-name');
const teamPointsDisplay = document.getElementById('team-points');
const lotsDisplay = document.getElementById('lots-display');
const loadingLotsText = document.getElementById('loading-lots-text');
const messageArea = document.getElementById('message-area');
const tasksContainer = document.getElementById('tasks-container');

/**
 * –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ POST-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ø—Ä–æ–∫—Å–∏-—Å–µ—Ä–≤–µ—Ä—É.
 * @param {string} endpoint - –ö–æ–Ω–µ—á–Ω–∞—è —Ç–æ—á–∫–∞ API –Ω–∞ –ø—Ä–æ–∫—Å–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 'submit_user', 'buy_lot').
 * @param {object} payload - –û–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏.
 * @returns {Promise<object>} - –ü—Ä–æ–º–∏—Å, —Ä–∞–∑—Ä–µ—à–∞—é—â–∏–π—Å—è —Å JSON-–æ—Ç–≤–µ—Ç–æ–º –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞.
 */
async function sendPostRequest(endpoint, payload) {
    const url = `${PROXY_API_URL}/api/${endpoint}`;
    try {
        const response = await fetch(url, {
            method: 'POST',
            mode: 'cors',
            headers: {
                'Content-Type': 'application/json', // –í–∞–∂–Ω–æ: –¥–ª—è Vercel-–ø—Ä–æ–∫—Å–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å application/json
            },
            body: JSON.stringify(payload),
        });

        if (!response.ok) {
            // –ü—ã—Ç–∞–µ–º—Å—è –ø—Ä–æ—á–∏—Ç–∞—Ç—å –æ—à–∏–±–∫—É –∏–∑ –æ—Ç–≤–µ—Ç–∞, –µ—Å–ª–∏ —ç—Ç–æ JSON
            const errorData = await response.json().catch(() => ({ message: response.statusText }));
            throw new Error(`HTTP error! Status: ${response.status}. Message: ${errorData.message || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞.'}`);
        }

        return await response.json();
    } catch (error) {
        console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞ –∫ ${endpoint}:`, error);
        showMessage(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
        return { error: error.message };
    }
}

/**
 * –ó–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–±–∞–ª–ª—ã, –∫–æ–º–∞–Ω–¥—É, –∏—Å—Ç–æ—Ä–∏—é) –∏ –ª–æ—Ç—ã –∏–∑ –º–∞–≥–∞–∑–∏–Ω–∞.
 */
async function loadUserData() {
    showMessage('', ''); // –°–∫—Ä—ã—Ç—å –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    loadingLotsText.style.display = 'block'; // –ü–æ–∫–∞–∑–∞—Ç—å "–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ—Ç–æ–≤..."
    lotsDisplay.innerHTML = '<p class="text-gray-500 col-span-full" id="loading-lots-text">–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ—Ç–æ–≤...</p>'; // –û—á–∏—Å—Ç–∏—Ç—å –∏ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥–ª—É—à–∫—É

    const data = {
        user_id: userId,
        username: username
    };

    const response = await sendPostRequest('submit_user', data);

    loadingLotsText.style.display = 'none'; // –°–∫—Ä—ã—Ç—å "–ó–∞–≥—Ä—É–∑–∫–∞ –ª–æ—Ç–æ–≤..."

    if (response && !response.error) {
        pointsDisplay.textContent = `${response.points ?? 0} üß†`;
        teamNameDisplay.textContent = response.team || '‚Äì';
        teamPointsDisplay.textContent = `${response.team_points ?? '‚Äì'} üß†`;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ª–æ—Ç–æ–≤
        displayLots(response.bonuses || [], response.points);

        // –ò—Å—Ç–æ—Ä–∏—è (–≤–∞—à —Å—Ç–∞—Ä—ã–π –∫–æ–¥, –µ—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –µ–≥–æ –≤–µ—Ä–Ω—É—Ç—å, –æ–Ω –±—ã–ª –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ HTML)
        // const historyList = document.getElementById('history-list');
        // if (historyList) { // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —ç–ª–µ–º–µ–Ω—Ç, –µ—Å–ª–∏ –≤—ã –µ–≥–æ —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–µ—Ç–µ
        //     historyList.innerHTML = '';
        //     if (!response.history || response.history.length === 0) {
        //         historyList.innerHTML = '<li class="text-gray-500">–ò—Å—Ç–æ—Ä–∏—è –ø—É—Å—Ç–∞</li>';
        //     } else {
        //         // –ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ä–µ–∞–ª—å–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤–µ–∑–¥:
        //         // (response.history || []).forEach(item => {
        //         //     const li = document.createElement('li');
        //         //     li.className = 'text-gray-700';
        //         //     li.textContent = item;
        //         //     historyList.appendChild(li);
        //         // });
        //         // –ò–ª–∏ –∫–∞–∫ —É –≤–∞—Å –±—ã–ª–æ:
        //         const stars = 'üß† '.repeat(response.history.length).trim();
        //         const li = document.createElement('li');
        //         li.className = 'text-green-500 text-xl';
        //         li.textContent = stars;
        //         historyList.appendChild(li);
        //     }
        // }


    } else {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', response.error);
        showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ª–æ—Ç—ã.', 'error');
        lotsDisplay.innerHTML = '<p class="text-gray-500 col-span-full">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ª–æ—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</p>';
    }
}

/**
 * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –ª–æ—Ç–æ–≤ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ.
 * @param {Array<object>} lots - –ú–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ –ª–æ—Ç–æ–≤ (–±–æ–Ω—É—Å–æ–≤).
 * @param {number} userPoints - –¢–µ–∫—É—â–∏–µ –±–∞–ª–ª—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
 */
function displayLots(lots, userPoints) {
    lotsDisplay.innerHTML = ''; // –û—á–∏—â–∞–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

    if (lots.length === 0) {
        lotsDisplay.innerHTML = '<p class="text-gray-500 col-span-full">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ –¥–ª—è –æ–±–º–µ–Ω–∞.</p>';
        return;
    }

    lots.forEach(lot => {
        const lotItem = document.createElement('div');
        lotItem.className = 'bg-gray-50 rounded-lg shadow p-4 lot-item flex flex-col'; // –î–æ–±–∞–≤–∏–ª flex-col

        const isAvailable = userPoints >= lot.cost;
        const buttonDisabled = !isAvailable;
        const statusClass = isAvailable ? 'text-green-600' : 'text-red-500';
        const missingText = isAvailable ? '' : ` (–Ω–µ–¥–æ—Å—Ç–∞–µ—Ç ${lot.missing_points} üß†)`;

        lotItem.innerHTML = `
            ${lot.image_url ? `<img src="${lot.image_url}" alt="${lot.title}" class="rounded-md mb-3">` : ''}
            <h3 class="text-lg font-bold mb-1">${lot.title}</h3>
            <p class="text-sm text-gray-700 mb-2 flex-grow">${lot.description}</p>
            <div class="text-md font-semibold text-gray-800 mb-3">–°—Ç–æ–∏–º–æ—Å—Ç—å: <span class="text-yellow-600">${lot.cost} üß†</span></div>
            <div class="text-xs italic ${statusClass} mb-3">${lot.available === '–¥–∞' ? '–î–æ—Å—Ç—É–ø–µ–Ω' : '–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω'}${missingText}</div>
            <button class="w-full bg-blue-500 text-white px-4 py-2 rounded-md hover:bg-blue-600 transition-colors duration-200 buy-button"
                    data-lot-name="${lot.title}"
                    ${buttonDisabled ? 'disabled' : ''}>
                –ö—É–ø–∏—Ç—å
            </button>
        `;
        lotsDisplay.appendChild(lotItem);
    });

    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫
    document.querySelectorAll('.buy-button').forEach(button => {
        button.addEventListener('click', (event) => {
            const lotName = event.target.dataset.lotName;
            if (lotName) {
                buyLot(lotName);
            }
        });
    });
}

/**
 * –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–∫—É–ø–∫—É –ª–æ—Ç–∞.
 * @param {string} lotName - –ù–∞–∑–≤–∞–Ω–∏–µ –ª–æ—Ç–∞ –¥–ª—è –ø–æ–∫—É–ø–∫–∏.
 */
async function buyLot(lotName) {
    // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø–æ–∫—É–ø–∫–æ–π
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ –∫—É–ø–∏—Ç—å "${lotName}" –∑–∞ —Å–∫–∞–∑–æ—á–Ω—É—é –º—É–¥—Ä–æ—Å—Ç—å?`)) {
        return;
    }

    showMessage('–ü–æ–∫—É–ø–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞...', 'info');
    // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–∫–∏, —á—Ç–æ–±—ã –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—Ç–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∫–ª–∏–∫–∏
    document.querySelectorAll('.buy-button').forEach(btn => btn.disabled = true);

    const data = {
        user_id: userId,
        username: username,
        lot_name: lotName
    };

    const response = await sendPostRequest('buy_lot', data);

    if (response && response.status === 'success') {
        showMessage(response.message, 'success');
        // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ª–æ—Ç—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –ø–æ–∫—É–ø–∫–∏
        await loadUserData();
    } else {
        const errorMessage = response.message || '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–æ–∫—É–ø–∫—É –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞.';
        showMessage(errorMessage, 'error');
    }
    // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫–∏ –æ–±—Ä–∞—Ç–Ω–æ
    document.querySelectorAll('.buy-button').forEach(btn => btn.disabled = false);
}

/**
 * –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –≤—Å–ø–ª—ã–≤–∞—é—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
 * @param {string} message - –¢–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è.
 * @param {'success'|'error'|'info'} type - –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏.
 */
function showMessage(message, type) {
    messageArea.textContent = message;
    messageArea.className = `message-area ${type}`; // –û–±–Ω–æ–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã
    messageArea.style.display = message ? 'block' : 'none'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–ª–∏ —Å–∫—Ä—ã–≤–∞–µ–º

    if (type === 'success' || type === 'error') {
        setTimeout(() => {
            messageArea.style.display = 'none';
        }, 5000); // –°–∫—Ä—ã–≤–∞–µ–º —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    }
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–¥–∞—á (–≤–∞—à —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥)
async function loadTasks() {
    try {
        const response = await fetch(`${PROXY_API_URL}/api/load_tasks`);
        const tasks = await response.json();

        tasksContainer.innerHTML = '';
        if (!tasks || tasks.length === 0) {
            tasksContainer.innerHTML = '<p class="text-gray-500">–ù–µ—Ç –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∑–∞–¥–∞–Ω–∏–π.</p>';
            return;
        }

        tasks.forEach(task => {
            const block = document.createElement('div');
            block.className = 'bg-white rounded-2xl shadow p-4';
            block.innerHTML = `
                <h2 class="text-xl font-semibold mb-2">ü§© ${task.title}</h2>
                <p class="text-sm mb-2 text-gray-700">${task.description}</p>
                <form class="space-y-2 task-form">
                    <input type="url" name="url" placeholder="–°—Å—ã–ª–∫–∞ –Ω–∞ –æ—Ç–≤–µ—Ç" class="w-full border border-gray-300 rounded px-3 py-2 text-sm" required />
                    <button type="submit" class="w-full bg-purple-500 text-white px-4 py-2 rounded hover:bg-purple-600 text-sm">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                </form>`;
            block.querySelector('form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const url = e.target.url.value.trim();
                if (!url) return;

                const submitResponse = await sendPostRequest('submit_task_response', {
                    user_id: userId,
                    username: username,
                    url: url,
                    task: task.title
                });

                if (submitResponse && !submitResponse.error) {
                    showMessage("–°–ø–∞—Å–∏–±–æ! –ú—É–¥—Ä–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∞.", 'success');
                    loadUserData();
                    e.target.url.value = '';
                } else {
                    showMessage("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–¥–∞–Ω–∏—è.", 'error');
                }
            });
            tasksContainer.appendChild(block);
        });
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∑–∞–¥–∞–Ω–∏–π:', error);
        showMessage('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –∑–∞–¥–∞–Ω–∏—è.', 'error');
    }
}


// –ó–∞–ø—É—Å–∫ —Ñ—É–Ω–∫—Ü–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
document.addEventListener('DOMContentLoaded', () => {
    // –ï—Å–ª–∏ –µ—Å—Ç—å keyword (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑ start_param), –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –µ–≥–æ
    if (keyword) {
        sendPostRequest('submit_keyword', { user_id: userId, username: username, keyword: keyword })
            .then(response => {
                if (response && response.status === 'added') {
                    showMessage(`–ú—É–¥—Ä–æ—Å—Ç—å –∑–∞ –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "${keyword}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∞!`, 'success');
                } else if (response && response.status === 'already_scanned') {
                    showMessage(`–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "${keyword}" —É–∂–µ –±—ã–ª–æ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–æ —Ä–∞–Ω–µ–µ.`, 'info');
                } else if (response && response.status === 'not found') {
                    showMessage(`–ö–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ "${keyword}" –Ω–µ –Ω–∞–π–¥–µ–Ω–æ –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ.`, 'error');
                } else if (response && response.error) {
                    showMessage(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞: ${response.error}`, 'error');
                }
                loadUserData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞
            })
            .catch(() => {
                showMessage('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞.', 'error');
                loadUserData(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –¥–∞–∂–µ –ø—Ä–∏ –æ—à–∏–±–∫–µ
            });
    } else {
        loadUserData(); // –ï—Å–ª–∏ –Ω–µ—Ç keyword, –ø—Ä–æ—Å—Ç–æ –∑–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    }

    loadTasks(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–¥–∞—á–∏
});
    </script>
</body>

</html>
